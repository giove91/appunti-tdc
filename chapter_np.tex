\chapter{Caratterizzazione e proprietà di \texorpdfstring{$\NP$}{NP}}

\section{\texorpdfstring{$\NP$}{NP} equivale ad \texorpdfstring{$\ESO$}{ESO}}

\begin{teorema}[Fagin]
  \label{thm:np-eso}
  $\NP = \ESO$.
\end{teorema}
\begin{proof}
 \mytodo{Da scrivere.}
\end{proof}


\section{Giochi di \EFl{}}
\begin{definizione}
 Siano $A$, $B$ due $L$-strutture. Descriviamo
 il gioco di \EFl{} $G_k(A,B)$ di durata $k \in \N$. Vi sono die giocatori
 indicati con i simboli ``$\exists$'' e ``$\forall$''. A ogni turno
 il giocatore $\forall$ sceglie un elemento da $A$ o da $B$. Il giocatore
 $\exists$ cerca di imitarlo scegliendo un elemento corrispondente nell'altra
 struttura. Dopo $k$ turni sono stati scelti degli elementi
 $a_1, \ldots, a_k \in A$ e $b_1, \ldots, b_k \in B$. Il giocatore $\exists$
 vince il gioco se
 \[ A, a_1, \ldots, a_k \equiv_{QF} B, b_1, \ldots, b_k,\]
 ovvero se, per ogni formula $\phi(x_1, \ldots, x_k)$ senza quantificatori, vale
 $A \models \phi(a_1, \ldots, a_k)$ se e solo se $B \models \phi(b_1, \ldots, b_k)$.
\end{definizione}

\begin{definizione}
 Date due $L$-strutture $A$ e $B$, diciamo che $A \EFeq_k B$ se e solo se
 il giocatore $\exists$ ha una strategia vincente per il gioco di \EF{} $G_k(A,B)$.
\end{definizione}

\begin{definizione}
 Date due $L$-strutture $A$ e $B$, diciamo che $A \equiv_k B$ se e solo se
 per ogni formula $\phi$ con rango di quantificazione $\RQ(\phi) \leq k$ vale
 $A \models \phi$ se e solo se $B \models \phi$.
\end{definizione}

\begin{osservazione}
 Date due $L$-strutture $A$ e $B$, vale $A \equiv_0 B$ se e solo se
 $A \equiv_{QF} B$ e vale $A \equiv B$ se e solo se per ogni $k \in \N$ vale
 $A \equiv_k B$.
\end{osservazione}

\begin{lemma}
\label{lemma:finite-formulas}
 Ci sono solo un numero finito di classi di $k$-equivalenza di $n$-uple,
 in particolare, se $C(n,k)$
 è l'insieme di tali classi $|C(n,k+1)| \leq s^{|C(n+1,k)|}$. Inoltre per ogni
 classe $H=[A,a_1,\ldots,a_n] \in C(n,k)$ esiste una formula $\phi_H$
 con $\RQ(\phi_H) \leq k$ tale che:
 \begin{enumerate}
  \item $A \models \phi_H(a_1, \ldots, a_n)$
  \item Se $B \models \phi_H(b_1,\ldots,b_n)$, allora $(A,a_1,\ldots, a_n) \EFeq_k (B,b_1,\ldots,b_k)$
 \end{enumerate}
\end{lemma}
\begin{proof}
 \mytodo{Da scrivere.}
\end{proof}



\begin{teorema}
 Date due $L$-strutture $A$ e $B$, se $A \EFeq_k B$ allora $A \equiv_k B$.
 Supponendo in più che $L$ sia un linguaggio finito senza simboli di funzioni,
 vale anche il viceversa, ovvero $A \equiv_k B$
 implica $A \EFeq_k B$.
\end{teorema}
\begin{proof}
 $\Rightarrow$) Procediamo per induzione su $k$. Per $k=0$ segue dall'osservazione
 precedente e dalle definizioni. Supponendo il risultato vero per $k$, dimostriamolo
 per $k+1$. Sia $\phi$ la più piccola formula di rango di quantificazione $k+1$
 su cui i due modelli sono in disaccordo. Possiamo suppore senza perdita di generalità
 che $\phi \equiv \exists y \theta(y)$ e che esista $a \in A$ tale che $A \models \theta(a)$.
 Per la definizione di gioco di \EF{} di durata $k+1$, esiste un $b \in B$ tale che
 $A,a \EFeq_k B,b$. Per ipotesi induttiva questo implica che
 $A,a \equiv_k B,b$, e in particolare, essendo $\RQ(\theta(y)) = k$, che
 $B \models \theta(b)$, da cui $B \models \exists y \theta(y)$.
 
 $\Leftarrow$) Supponiamo $A,a_1,\ldots, a_n \equiv_k B, b_1, \ldots, b_n$, sia
 $H=[A,a_1,\ldots,a_n]$ e sia $\phi_H$ come nel Lemma \ref{lemma:finite-formulas}.
 Dato che $\RQ(\phi_H) \leq k$, vale $B \models \phi_H(b_1,\ldots,b_n)$
 e dunque per il lemma si ha $A,a_1,\ldots, a_n \EFeq_k B, b_1, \ldots, b_n$.
\end{proof}


\section{\texorpdfstring{$\ESOmon \neq \coESOmon$}{ESOmon not equal to coESOmon}}

Sebbene non si sappia se $\NP\neq\coNP$, si può dimostrare un risultato simile: $\ESOmon \neq \coESOmon$.
\mytodo{Definire $\ESOmon$.}
Per fare questo utilizzeremo i giochi di EF \mytodo{Sostituire il command}, introdotti nella Sezione \mytodo{Inserire la sezione}.


\begin{definizione}
  Sia $A$ una $L$-struttura.
  Il grafo di Gaifman di $A$ è un grafo non orientato $G_A = (|A|, E^A)$, dove $G_A \models E(a,b)$ se e solo se $a$ e $b$ sono distinti e sono parte di una tupla $(c_1,\dots,c_r)$ di elementi di $A$ tali che $A\models R(c_1,\dots,c_r)$ per una qualche relazione $r$-aria $R\in L$.
\end{definizione}

\begin{osservazione}
  Se $L=\{E\}$ è il linguaggio dei grafi (con un'unica relazione $E$ binaria) e $A$ è un grafo non orientato, allora $G_A=A$.
\end{osservazione}

\begin{definizione}
  Data una $L$-struttura $A$, l'$n$-intorno $S_A(n,a)$ di un elemento $a\in A$ è la sottostruttura di $A$ definita nel seguente modo:
  \[ S_A(n,a) = \{ b\in A \mid d_{G_A}(a,b) \leq n \}. \]
\end{definizione}

\begin{definizione}
  Siano $(A,a)$ e $(B,b)$ due $L$-strutture puntate. Diciamo che esse sono $n$-equivalenti secondo Gaifman se esiste un isomorfismo di strutture tra $S_A(n,a)$ ed $S_B(n,b)$ che manda $a$ in $b$.
  La notazione che useremo per indicare la $n$-equivalenza secondo Gaifman è la seguente: $(A,a) \gaifmaneq{n} (B,b)$.
\end{definizione}

\begin{definizione}
  Chiamiamo $n$-tipo di $a$ in $A$ la classe di equivalenza di $(A,a)$ rispetto alla relazione $\gaifmaneq{n}$.
\end{definizione}

\begin{definizione}
  Date due $L$-strutture $A$ e $B$, diciamo che $A\gaifmaneq{n} B$ se per ogni $n$-tipo $t$, $A$ e $B$ hanno lo stesso numero di elementi di $n$-tipo $t$.
\end{definizione}


\begin{teorema}
  $A \gaifmaneq{3^n} B$ implica ???
\end{teorema}



------------


In questa sezione, utilizzeremo il linguaggio dei grafi $L=\{E\}$, con $E$ relazione binaria.
Ci restringiamo alla classe dei grafi non orientati, ovvero i grafi $A=(|A|,E^A)$ per i quali la relazione $E^A$ è simmetrica.
Introduciamo il problema decisionale ``$\Connected$'', al quale appartengono tutti e soli i grafi connessi.
Dimostreremo che tale problema appartiene a $\coESOmon$ ma non ad $\ESOmon$.

\begin{lemma}
  $\Connected \in \coESOmon$.
\end{lemma}

\begin{proof}
  Dobbiamo esprimere la proprietà di essere sconnesso con una formula in $\ESOmon$.
  Una condizione equivalente ad essere sconnesso è che l'insieme dei vertici possa essere partizionato in due sottoinsiemi tra i quali non vi è alcun arco. Questa condizione può essere espressa mediante la seguente formula $\ESOmon$:
  \[ \exists \, U^{(1)}, W^{(1)} \Big( \forall x \big( U(x) \dot\lor W(x) \big) \,\wedge\, \forall x,y \big( E(x,y) \rightarrow (U(x) \leftrightarrow \lnot W(y))\big) \Big). \]
  Quindi $\Connected \in \coESOmon$.
\end{proof}






\begin{lemma}
  
\end{lemma}


\begin{lemma}
  $\Connected \not\in \ESOmon$.
\end{lemma}

\begin{proof}
  Supponiamo per assurdo che esista una $L$-formula $\exists P_1^{(1)},\ldots,P_r^{(1)} \varphi$, con $\varphi\in \FO$, tale che per ogni grafo non orientato $G=(V^G, E^G)$ si abbia
  \[ G \models (\exists \vec{P}) \varphi \, \leftrightarrow G \text{ connesso}. \]
  Sia $m=\RQ(\varphi)$, e sia $\tau = \{E,P_1,\ldots,P_r\}$ un nuovo linguaggio che estende $L$ in cui le $P_i$ sono relazioni unarie.
  Osserviamo che una $\tau$-struttura può essere considerata come un grafo colorato con $2^r$ colori, dove il colore del vertice $x$ è codificato dai bit $P_1(x),\ldots,P_r(x)$.
  
  
\end{proof}



\begin{teorema}
  $\ESOmon \neq \coESOmon$.
\end{teorema}




\section{\texorpdfstring{$\NP$}{NP}-completezza di \texorpdfstring{$\SAT$}{SAT}}

Il Teorema~\ref{thm:np-eso} consente di dimostrare in modo particolarmente semplice l'$\NP$-com\-ple\-tez\-za del problema di soddisfacibilità booleana di formule proposizionali, denominato comunemente ``$\SAT$''.

\begin{teorema}
  $\SAT$ è $\NP$-completo.
\end{teorema}

\begin{proof}
  $\SAT$ appartiene a $\NP$ perché un certificato di soddisfacibilità di una formula è dato dal valore da assegnare alle variabili per fare in modo che la formula risulti vera.
  
  Dobbiamo dimostrare che un qualsiasi problema $\mathcal{B}\in\NP$ si riduce polinomialmente a $\SAT$.
  Supponiamo che $\mathcal{B}$ sia un insieme di strutture nel linguaggio $L=\{R_1,\dots,R_t\}$, dove $R_1,\dots,R_t$ sono relazioni di arietà $b_1,\dots,b_t$, rispettivamente.
  Per il Teorema~\ref{thm:np-eso}, esiste una formula $\gamma$ della forma
  \[ \gamma :\equiv \exists\, S_1,\dots,S_r \, \forall \underbrace{x_1,\dots,x_n}_{\text{prim'ordine}} \, \underbrace{\varphi(x_1,\dots,x_k)}_{\text{senza quantificatori}} \]
  tale che $\mathcal{B}$ sia dato dai modelli di $\gamma$.
  
  Sia $A$ una $L$-struttura, e sia $n=|A|$. Abbiamo che $A$ appartiene a $\mathcal{B}$ se e solo se soddisfa la formula $\gamma$, ovvero se e solo se esistono delle relazioni $S_1^A\subseteq n^{a_1}, \dots, S_r^A\subseteq n^{a_r}$ tali che sia soddisfatta $\forall x_1,\dots,x_n \,\varphi(x_1,\dots,x_k)$.
  Questo è equivalente a trovare un'assegnazione che renda vera la formula proposizionale
  \[ \psi :\equiv \bigwedge_{0\leq c_1,\dots,c_k < n} \varphi(c_1,\dots,c_k) \]
  nelle varabili booleane $S_i(\vec{y})$ ed $R_j(\vec{z})$, al variare di $i\in \{1,\ldots,r\}$, $j\in\{1,\dots,t\}$, $\vec{y}\in n^{a_i}$, $\vec{z}\in n^{b_j}$.
  Sostituiamo a ciascuna variabile del tipo $R_j(\vec{z})$ il valore vero o falso, a seconda che valga o meno $A \models R_i(\vec{z})$; chiamiamo $\tilde\psi$ la formula così ottenuta, che dipende ora solamente dalle variabili $S_i(\vec{y})$ al variare di $i$ e di $\vec{y}\in n^{a_i}$.
  In conclusione, $A$ appartiene a $\mathcal{B}$ se e solo se esiste un'assegnazione delle variabili $S_i(\vec{y})$ che rende vera la $\psi$. Il numero di tali variabili è $n^{a_1}+\ldots+n^{a_r}$, che è un polinomio in $n$.
  Abbiamo quindi mostrato una riduzione polinomiale di $\mathcal{B}$ a $\SAT$.
\end{proof}
